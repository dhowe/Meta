<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<!-- change fcfcfc -> 10004f   for dark borders -->

<title>Writing Digital Media | PmWiki / CustomMarkup browse</title>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Content-Style-Type" content="text/css">

<!-- Update these tags -->
<meta name="description" content="programming for digital art and literature course web">
<meta name="keywords" content="e-writing daniel howe programming digital art literature">

<style type="text/css">@import url("pub/skins/evolver/evolver.css");
  <!-- $PageInlineStyle  -->
</style>

<!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none;}

--></style>  <meta name='robots' content='noindex,nofollow' />

</head>

<body> 

<table cellspacing="0" cellpadding="0" border="0" width="100%"
background="uploads/cardheader2.jpg"><!-- bgcolor=#4670ae -->

<tr><td height=120 valign=top>

<table cellspacing="0" cellpadding="5" border="0" height=100% width="1025">
<tr>
<!--td style="padding-left: 20px" align="left" valign="bottom"-->
<td align="right" valign="bottom">
	<table width=197 cellspacing="2" border="0" bgcolor="#cccfd6">
	<tr>
        <td bgcolor="#f9f9f9" class="action" align="center"><a class="navlink" href="index.php-n=PmWiki.CustomMarkup_action=edit.html">edit</a></td>
<td bgcolor="#f9f9f9" class="action" align="center"><a class="navlink" href="index.php-n=PmWiki.CustomMarkup_action=upload.html">upload</a></td>
<td bgcolor="#f9f9f9" class="action" align="center"><a class="navlink" href="index.php-n=Site.AllRecentChanges.html" rel="external">recent</a></td>
<td bgcolor="#f9f9f9" class="action" align="center"><a class="navlink" href="index.php-n=PmWiki.CustomMarkup_action=print.html" rel="external">print</a></td>
	
	</tr>
	</table>
</td>
</tr></table>
</td></tr>


<tr>
  <td><!-- top horizontal bar -->
    <table cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr><td height=0 bgcolor=#cccfd6></td></tr>
    <tr>
      <td bgcolor="#fcfcfc" style="padding-left: 10px">
        <table cellpadding="0" cellspacing="0" border="0">
        <tr>

		<td valign="top" style="padding-top: 16px" bgcolor="#fcfcfc">

<table cellspacing="2" cellpadding="0" border="0" bgcolor="#CCCFD6" width="100%">
		<tr><td class="searchheader" height=20>
        <strong><a href='index.php-n=Site.Search.html'>Search</a></strong>
		     </td>
    </tr>

		<tr><td class="searchcell">
       <form action='https://rednoise.org/teaching/wdm/index.php?n=Site.Search'>
        <input type="hidden" name="pagename" value="Site/Search" />
        <input class="navinput" size="10" type="text" name="q" value="" />
        <input class="navbutton" type="submit" value="Go" />
        </form>
		  </td>
    </tr>

</table>
		<br>
<table cellspacing="2" cellpadding="0" border="0" bgcolor="#CCCFD6" width="100%">

  <tr><td id='wikileft' height=2000
valign=top>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<ul><li><a class='wikilink' href='index.php-n=Main.HomePage.html'><strong><span style='font-size:120%'>Home</span></strong></a>
<div class='vspace'></div></li><li><a class='wikilink' href='index.php-n=Main.Slides.html'>Slides</a>
</li><li><a class='wikilink' href='index.php-n=Main.Assignments.html'>Assignments</a>
</li><li><a class='wikilink' href='index.php-n=Main.Readings.html'>Readings</a>
</li><li><a class='wikilink' href='index.php-n=Main.Freedom.html'>Freedom</a>
</li><li><a class='wikilink' href='index.php-n=Main.Questions.html'>Questions</a>
</li><li><a class='wikilink' href='index.php-n=Main.Grading.html'>Grading</a>
<div class='vspace'></div></li><li><a class='wikilink' href='index.php-n=Main.Artists.html'>Artists</a>
</li><li><a class='wikilink' href='index.php-n=Main.ShortShorts.html'>ShortShorts</a>
</li><li><a class='wikilink' href='index.php-n=Main.Presentations.html'>Presentations</a>
</li><li><a class='urllink' href='http://www.rednoise.org/rita/' rel='nofollow'>The RiTa Library</a>
</li><li><a class='wikilink' href='index.php-n=Main.EditorExamples.html'>RiTa @p5js-editor</a>
</li><li><a class='wikilink' href='index.php-n=Main.Works.html'>ExampleWorks</a>
</li><li><a class='wikilink' href='index.php-n=Main.Exercises.html'>WritingIdeas</a>
</li><li><a class='wikilink' href='index.php-n=Main.PoeticForms.html'>PoeticForms</a>
</li><li><a class='wikilink' href='index.php-n=Main.Techniques.html'>Techniques</a>
</li><li><a class='wikilink' href='index.php-n=Main.TwitterBots.html'>TwitterBots</a>
<div class='vspace'></div></li><li><a class='urllink' href='http://processing.org/reference/' rel='nofollow'>P5.js Reference</a>
</li><li><a class='urllink' href='http://www.rednoise.org/rita/reference' rel='nofollow'>The RiTa API</a>
</li><li><a class='urllink' href='http://www.rednoise.org/tweeter/doc' rel='nofollow'>Tweeter API</a>
</li><li><a class='urllink' href='http://docs.oracle.com/javase/6/docs/api' rel='nofollow'>Java API</a>
</li><li><a class='urllink' href='http://processing.org/reference/' rel='nofollow'>Processing API</a>
</li><li><a class='urllink' href='http://twitter4j.org/oldjavadocs/4.0.2' rel='nofollow'>Twitter4j API</a>
</li><li><a class='wikilink' href='index.php-n=Main.Grammars.html'>Grammars</a>
</li><li><a class='wikilink' href='index.php-n=Main.N-Grams.html'>N-Grams</a>
<div class='vspace'></div></li><li><a class='wikilink' href='index.php-n=Site.SideBar_action=edit.html'>SideBar</a>
</li></ul>

                   <!--Main.SideBar-->
        </td>
  </tr>

		</table>

    <!--/PageLeftFmt-->

		</td>

		<td valign="top" bgcolor=#fcfcfc>
		<table cellspacing="0" cellpadding="0" border="0" width=640>
  		<tr>
    		<td bgcolor="#fcfcfc" style="padding-left: 10px; padding-top: 12px; padding-right: 15px">

                <!--PageTitleFmt-->
                <strong><h2 class="titletext">
                   <a href="index.php-n=PmWiki.PmWiki.html">PmWiki</a> &raquo; 
                   <a href="index.php-n=PmWiki.CustomMarkup.html">CustomMarkup</a>
                </h2></strong>

<div style="width: 50em; margin-right:10px; margin-left:10px">
                <!--PageText-->
<div id='wikitext'>
<p>
<a name='trailstart' id='trailstart'></a> 
</p><div style='clear:right; float:right; font-size:smaller; background-color:#eee;' >
<p><span class='wikitrail'>&lt; <a class='wikilink' href='index.php-n=PmWiki.Security.html'>Security</a> | <a class='wikilink' href='index.php-n=PmWiki.DocumentationIndex.html#trailstart'>Documentation Index</a> | <a class='wikilink' href='index.php-n=PmWiki.CustomWikiStyles.html'>Custom wiki styles</a> &gt;</span> 
</p></div>
<div style='clear:right;' ><span class='frame rfloat' style='font-size: smaller; background-color: #ffffcc; clear: right;'>administrators (intermediate) </span>
</div>
<h2>Introduction</h2>
<p>PmWiki's markup translation engine is handled by a set of rules; each rule searches for a specific pattern in the markup text and replaces it with some replacement text.  Internally, this is accomplished by using PHP's "<a class='urllink' href='http://www.php.net/preg_replace' rel='nofollow'>preg_replace</a>" function.
</p>
<p class='vspace'>Rules are added to the translation engine via PmWiki's Markup() or <a href='index.php-n=PmWiki.CustomMarkup.html#php55'>Markup_e()</a> functions, which look like
</p><div class='indent'><pre class='escaped'>Markup($name, $when, $pattern, $replace); # if no evaluation is needed, or if PHP &lt; 5.5
Markup_e($name, $when, $pattern, $replace); # if evaluation is needed and PHP &gt;= 5.5</pre>
</div><div class='vspace'></div><ul><li><code class='escaped'>$name</code> is a unique name (a string) given to the rule
</li><li><code class='escaped'>$when</code> says when the rule should be applied relative to other rules
</li><li><code class='escaped'>$pattern</code> is the pattern to be searched for in the markup text
</li><li><code class='escaped'>$replace</code> is what the pattern should be replaced with.
</li></ul><p class='vspace'>For example, here's the code that creates the rule for <code class='escaped'>''emphasized text''</code> (in <em>scripts/stdmarkup.php</em>):
</p><div class='indent'><code class='escaped'>Markup("em", "inline", "/''(.*?)''/", "&lt;em&gt;$1&lt;/em&gt;");</code>
</div><p class='vspace'>Basically this statement says to create a rule called "em" to be performed with the other "inline" markups, and the rule replaces any text inside two pairs of single quotes with the same text ($1) surrounded by <code class='escaped'>&lt;em&gt;</code> and <code class='escaped'>&lt;/em&gt;</code>.
</p>
<div class='vspace'></div><h3>Sequence in which rules are applied</h3>
<p>The first two parameters to Markup() are used to specify the sequence in which rules should be applied.  The first parameter provides a name for a rule -- "<code class='escaped'>em</code>" in the example above.  We could've chosen other names such as "<code class='escaped'>''</code>", or even "<code class='escaped'>twosinglequotes</code>".  In general PmWiki uses the markup itself to name the rule (i.e., PmWiki uses "<code class='escaped'>''</code>" instead of "<code class='escaped'>em</code>"), but to keep this example easier to read later on we'll use a mnemonic name for now.
</p>
<p class='vspace'>The second parameter says that this rule is to be done along with the other "inline" markups.  PmWiki divides the translation process into a number of phases:
</p>
<div class='vspace'></div><pre>  _begin      start of translation
    {$var}    <a class='wikilink' href='index.php-n=PmWiki.PageTextVariables.html'>Page Text Variables</a> happen here.
  fulltext    translations to be performed on the full text            
  split       conversion of the full markup text into lines to be processed
  directives  directive processing
  inline      inline markups
  links       conversion of <a class='wikilink' href='index.php-n=PmWiki.Links.html'>links</a>, url-links, and WikiWords     
  block       block markups
  style       style handling       
  _end        end of translation
</pre><p class='vspace'>This argument is normally specified as a left-angle bracket ("before") or a right-angle bracket ("after") followed by the name of another rule. 
</p>
<p class='vspace'>Thus, specifying "inline" for the second parameter says that this rule should be applied when the other "inline" rules are being performed.  If we want a rule to be performed with the directives -- i.e., before inline rules are processed, we would specify "directives" or "&lt;inline" for the second parameter.
</p>
<div class='vspace'></div><h5>{$var} and (:if ...:) conditionals</h5>
<p>A significant rule in terms of ordering is "{$var}" which substitutes variables -- if you say "&lt;{$var}" then your markup will be processed before variables are substituted whereas if you say "&gt;{$var}" then your markup will be processed after variables are substituted.  This happens before conditional (:if...:) expressions, which is why page text variables are processed even if they are defined inside (:if false:).
</p>
<div class='vspace'></div><h3>Markup regular expression definition</h3>
<p>The third parameter is a Perl-compatible regular expression. Basically, it is a slash, a <a class='urllink' href='http://www.php.net/manual/en/reference.pcre.pattern.syntax.php' rel='nofollow'>regular expression</a>, another slash, and a set of optional <a class='urllink' href='http://www.php.net/manual/en/reference.pcre.pattern.modifiers.php' rel='nofollow'>modifiers</a>.
</p>
<p class='vspace'>The example uses the pattern string <code class='escaped'>"/''(.*?)''/"</code>, which uses <code class='escaped'>''(.*?)''</code> as the regular expression and no options. (The regular expression says "find two single quotes in succession, then as few arbitrary characters as are needed to make the match find something, then two additional single quotes in succession"; the parentheses "capture" a part of the wikitext for later use.)
</p>
<div class='vspace'></div><h3>Replacement text</h3>
<p>The fourth parameter is the replacement text that should be inserted instead of the marked-up wikitext. You can use <code class='escaped'>$1</code>, <code class='escaped'>$2</code>, etc. to insert the text from the first, second etc. parenthesised part of the regular expression.
</p>
<p class='vspace'>In the example, we have <code class='escaped'>"&lt;em&gt;$1&lt;/em&gt;"</code>, which is an <code class='escaped'>&lt;em&gt;</code>, the text matched by the first parentheses (i.e. by the <code class='escaped'>.*?</code> section of the pattern), and <code class='escaped'>&lt;/em&gt;</code>.
</p>
<p class='vspace'>Here's a rule for <code class='escaped'>@@monospaced@@</code> text:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("@@", "inline", "/@@(.*?)@@/", "&lt;code&gt;$1&lt;/code&gt;");</code>
</div><p class='vspace'>and for a <code class='escaped'>[:comment ...:]</code> directive that is simply removed from the output:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("comment", "directives", "/\\[:comment .*?:\\]/", '');</code>
</div><p class='vspace'>Okay, now how about the rule for <code class='escaped'>'''strong emphasis'''</code>?  We have to be a bit careful here, because although this translation should be performed along with other inline markup, we also have to make sure that the rule for <code class='escaped'>'''</code> is handled <em>before</em> the rule for <code class='escaped'>''</code>, because <code class='escaped'>'''</code> also contains <code class='escaped'>''</code>. The second parameter to Markup() can be used to specify the new rule's relationship to any other rule:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>Markup("strong", "&lt;em", "/'''(.*?)'''/", "&lt;strong&gt;$1&lt;/strong&gt;");</code>
</div><p class='vspace'>This creates a rule called "strong", and the second parameter "&lt;em" says to be sure that this rule is processed before the "em" rule we defined above.  If we wanted to do something after the "em" rule, we would use "&gt;em" instead.  Thus, it's possible to add rules at any point in PmWiki's markup translation process in an extensible manner.  (In fact, the "inline", "block", "directives", etc., phases above are just placeholder rules used to provide an overall sequence for other rules.  Thus one can use "&lt;inline" to specify rules that should be handled before any other inline rules.)             
</p>
<p class='vspace'>If you want to disable available markup just call e.g.:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>DisableMarkup("strong");</code>
</div><p class='vspace'>PmWiki's default markup rules are defined in the <em>scripts/stdmarkup.php</em> file.  To see the entire translation table as the program is running, the scripts/diag.php module adds "<code class='escaped'>?action=ruleset</code>", which displays the set of defined markup rules in the sequence in which they will be processed.  You can see it at <a class='wikilink' href='index.php-n=PmWiki.CustomMarkup_action=ruleset.html'>CustomMarkup?action=ruleset</a>. You must first enable the action by setting <a class='varlink' href='index.php-n=PmWiki.DebugVariables.html#EnableDiag'><code class='varlink'>&#36;EnableDiag</code></a> = 1 in your configuration file.
</p>
<div class='vspace'></div><h2>Other common examples</h2>
<h3>Define a custom markup to produce a specific HTML or Javascript sequence</h3>
<p>Suppose an admin wants to have a simple "<code class='escaped'>(:example:)</code>" markup that will always produce a fixed HTML string in the output, such as for a webring, Google AdSense display, or Javascript.  The Markup() call to do this would be:
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
Markup('example', 'directives',
  '/\\(:example:\\)/',
  Keep("&lt;div class='example'&gt;&lt;p&gt;Here is a 
    &lt;a target='_blank' href='http://www.example.com'&gt;link&lt;/a&gt; to
    &lt;em&gt;example.com&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;") );
</pre>
</div><div class='vspace'></div><ul><li>The first argument is a unique name for the markup ("example").
</li><li>The second argument says to perform this markup along with other directives.
</li><li>The third argument is the pattern to look for "(:example:)".
</li><li>The fourth argument is the HTML that "(:example:)" is to be replaced with.  We use the Keep() function here to prevent the output from being further processed by PmWiki's markup rule -- in the above example, we don't want the <a class='urllink' href='http://www.example.com' rel='nofollow'>http://www.example.com</a> url to be again converted to a link.
</li></ul><p class='vspace'><a name='random' id='random'></a>
</p><h3>Define a markup to call a custom function that returns content</h3>
<div class='indent'><span  style='color: red;'> The /e modifier has been deprecated and should not be used in ongoing development. See <a style='color: red' href='index.php-n=PmWiki.CustomMarkup.html#php55'>below</a> for more details.</span>
</div><p class='vspace'>An 'e' option on the <code class='escaped'>$pattern</code> parameter will cause the <code class='escaped'>$replace</code> parameter to be treated as a PHP expression to be evaluated instead of replacement text.  Thus, a markup to produce a random number between 1 and 100 might look like:
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
Markup('random', 'directives',
  '/\\(:random:\\)/e',
  "rand(1, 100)");
</pre>
</div><p class='vspace'>This calls the PHP built-in rand() function and substitutes the directive with the result.  Any function can be called, including functions defined in a <a class='wikilink' href='index.php-n=PmWiki.LocalCustomizations.html'>local customization</a> file.
</p>
<p class='vspace'>Arguments can also be passed by using regular expression capturing parentheses, thus
</p>
<div class='vspace'></div><div class='indent'><pre class='escaped'>
Markup('randomargs', 'directives',
  '/\\(:random (\\d+) (\\d+):\\)/e',
  "rand('$1', '$2')");
</pre>
</div><p class='vspace'>will cause the markup <code class='escaped'>(:random 50 100:)</code> to generate a random number between 50 and 100.
</p>
<div class='vspace'></div><div class='indent'><span  style='font-style: italic; color: green;'> Note:  Be very careful with the /e modifier in regular expressions; malicious authors may be able to pass strings that cause arbitrary and undesirable PHP functions to be executed.</span>
</div><p class='vspace'>For a PmWiki function to help with parsing arbitrary sequences of arguments and key=value pairs, see <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/ParseArgs' rel='nofollow'>Cookbook:ParseArgs</a>.
</p>
<p class='vspace'><a name='php55' id='php55'></a>
</p><h2>Migration to PHP 5.5 and <code>Markup_e()</code></h2>
<p>Since PHP version 5.5, the <code>/e</code> evaluation modifier is deprecated and some hosting providers don't allow its use.
</p>
<p class='vspace'>Recent <a class='wikilink' href='index.php-n=PmWiki.ReleaseNotes.html'>versions</a> of the PmWiki core (2.2.58 and newer) allow new ways to define markup rules without being dependent on the <code>/e</code> eval modifier. The historical ways to define markup rules are not removed and work, but may be incompatible with PHP 5.5 installations.
</p>
<p class='vspace'><em>Note: if your replacement pattern doesn't need evaluation, you must use <code>Markup()</code> like before and not <code>Markup_e()</code>.</em>
</p>
<div class='vspace'></div><div class='frame' > 
<p>THE SHORT ANSWER: If your markup regular expression (the 3rd argument) contains an "e" after the closing slash (i.e., <code>/regex/e</code> or <code>/regex/se</code> or etc) AND your 4th argument is entirely surrounded with double-quotes then you may be able to get away with simply following these 3 simple steps:
</p>
<div class='vspace'></div><ol><li>Replace the function name <code>Markup</code> with <code>Markup_e</code>
</li><li>Delete the "e" from after the closing slash in the 3rd argument
</li><li>Replace all occurrences of '$1' with \$m[1] and '$2' with \$m[2] and etc (note the quotes carefully!) in your 4th argument
</li></ol><p class='vspace'>In some cases this will not suffice - it depends on how quoting was done - but in many cases following these simple 3 steps will result in PHP 5.5+ compatibility. 
</p>
<p class='vspace'>If you try those 3 steps and are still having problems then continue to read below for a deeper understanding.
</p></div>
<p class='vspace'>The following is acceptable for PHP 5.5+ (compatible with PmWiki 2.2.58+, will also work in PHP 5.4 and older)
</p><ul><li><code>Markup($name, $when, $pattern, $replace)</code>; 
<ul><li><code>$pattern</code> can no longer have an "<code>/e</code>" modifier
</li><li><code>$replace</code> can be a string with matches as $1, $2 etc.
</li><li><code>$replace</code> can be a function name (callback) which will be called with the array of matches as argument
</li><li>instead of a string, the fourth parameter can be a definition of an anonymous function (note you can use anon functions this way since <a class='urllink' href='http://php.net/manual/en/functions.anonymous.php' rel='nofollow'>PHP 5.3.0+</a>).
</li><li>for PHP 5.4 or earlier, $pattern can have an /e modifier. The existing ways still work, but under PHP 5.5, they trigger warnings for deprecated feature.
</li></ul><div class='vspace'></div></li><li><code>Markup_e($name, $when, $pattern, $replace)</code>;
<ul><li><code>$pattern</code> cannot have an "/e" modifier
</li><li><code>$replace</code> can be a string with program code to be evaluated; note that the matches can be accessed with $m[1], $m[2] instead of '$1', '$2'
</li><li><code>$replace</code> can be a function name (callback) which will be called with the array of matches as argument (PmWiki 2.2.59+).
</li></ul></li></ul><p class='vspace'>Examples:
</p>
<div class='vspace'></div><ul><li>For PHP 5.4 and older, this is acceptable:<pre class='escaped'>
Markup('randomargs', 'directives',
  '/\\(:random (\\d+) (\\d+):\\)/e',
  "rand('$1', '$2')"
  );</pre>
<div class='vspace'></div></li><li>For PHP 5.5 and newer, $replace is code, we call Markup_e():<pre class='escaped'>
Markup_e('randomargs', 'directives',
  '/\\(:random (\\d+) (\\d+):\\)/',
  "rand(\$m[1], \$m[2])"
  );</pre>
The array $m contains the matches in parentheses from the $pattern. The matches \$m[1] have a backslash before the $ sign to not be evaluated in the double-quoted string. <span  style='font-style: italic; color: green;'> This will also work in PHP 5.4 and older</span> but requires PmWiki 2.2.58 or newer.
<div class='vspace'></div></li><li>For PHP 5.5 and newer, $replace is callback, we call Markup():<pre class='escaped'>
Markup('randomargs', 'directives',
  '/\\(:random (\\d+) (\\d+):\\)/',
  "MyRandom"
  );
function MyRandom($matches) {
  return rand($matches[1], $matches[2]);
}
</pre>
<span  style='font-style: italic; color: green;'> This will also work in PHP 5.4 and older</span> but requires PmWiki 2.2.58 or newer.
</li></ul><p class='vspace'>Other example:
</p><ul><li>PHP 5.4 or older: <pre class='escaped'>
Markup('Maxi:','&lt;links',
  "/\\b([Mm]axi:)([^\\s\"\\|\\[\\]]+)(\"([^\"]*)\")?/e",
  "Keep(LinkMaxi(\$pagename,'$1','$2','$4','$1$2'),'L')"
  );
</pre>
<div class='vspace'></div></li><li>PHP 5.5 or newer, PmWiki 2.2.58+, $replace is program code, we call Markup_e(): <pre class='escaped'>
Markup_e('Maxi:','&lt;links',
  "/\\b([Mm]axi:)([^\\s\"\\|\\[\\]]+)(\"([^\"]*)\")?/",
  "Keep(LinkMaxi(\$pagename,\$m[1],\$m[2],\$m[4],\$m[1].\$m[2]),'L')"
);
</pre>
The '$1$2' string in the old version is replaced with \$m[1].\$m[2], two concatenated elements of the matches array.  <span  style='font-style: italic; color: green;'> This will also work in PHP 5.4 and older</span> but requires PmWiki 2.2.58 or newer.
<div class='vspace'></div></li><li>$replace can also be a callback function, we call Markup(): <pre class='escaped'>
Markup('Maxi:','&lt;links',
  "/\\b([Mm]axi:)([^\\s\"\\|\\[\\]]+)(\"([^\"]*)\")?/",
  "CallbackMaxi"
);
function CallbackMaxi($m) {
  extract($GLOBALS["MarkupToHTML"]); # to get $pagename
  return Keep(LinkMaxi($pagename,$m[1],$m[2],$m[4],$m[1].$m[2]),'L');
}
</pre>
Obviously, the LinkMaxi() function could also be rewritten to accept the matches array directly.  <span  style='font-style: italic; color: green;'> This will also work in PHP 5.4 and older</span> but requires PmWiki 2.2.58 or newer.
</li></ul><p class='vspace'>The above may seem complicated, but it is actually simpler to use your own callback function:
</p><div class='frame' ><pre class='escaped'>
Markup('mykey', 'directives', 
  '/\\(:mydirective (.*?) (.*?):\\)/i',
  'MyFunction'
);
function MyFunction($matches) {
  extract($GLOBALS["MarkupToHTML"]);

  # ... do stuff with $matches ...

  return $out; # or return Keep($html);
}
</pre> 
</div>
<div class='vspace'></div><h3>Markup for both new and old versions of PmWiki</h3>
<p>If you want your recipe to work with PmWiki 2.2.58 and newer on PHP 5.5 and with older PmWiki+PHP versions, you can use something like this:
</p><div class='frame' ><pre class='escaped'>
if(function_exists('Markup_e')) { # new format, no /e
  Markup_e('rnd', 'directives', '/\\(:random (\\d+) (\\d+):\\)/', "rand(\$m[1], \$m[2])");
}
else { # old format
  Markup('rnd', 'directives', '/\\(:random (\\d+) (\\d+):\\)/e', "rand($1, $2)");
}
</pre> 
</div>
<p class='vspace'>If you have any questions about the new way to define custom markup, you can ask us <a class='createlinktext' rel='nofollow'
    href='index.php-n=PmWiki.CustomMarkup-Talk_action=edit.html'>at the talk page</a><a rel='nofollow' 
    class='createlink' href='index.php-n=PmWiki.CustomMarkup-Talk_action=edit.html'>?</a> or on the <a class='wikilink' href='index.php-n=PmWiki.MailingLists.html'>mailing lists</a>.
</p>
<div class='vspace'></div><h2>FAQ</h2>
<div class='faq' > <a name='faq' id='faq'></a> 
<p class='question'> How can I embed JavaScript into a page's output?</p>
<p> There are several ways to do this.  The <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/JavaScript' rel='nofollow'>Cookbook:JavaScript</a> recipe describes a simple means for embedding static JavaScript into web pages using <a class='selflink' href='index.php-n=PmWiki.CustomMarkup.html'>custom markup</a>.  For editing JavaScript directly in wiki pages (which can pose various security risks), see the <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/JavaScript-Editable' rel='nofollow'>JavaScript-Editable</a> recipe.  For JavaScript that is to appear in headers or footers of pages, the <a class='wikilink' href='index.php-n=PmWiki.Skins.html'>skin</a> template can be modified directly, or &lt;script&gt; statements can be inserted using the <a class='varlink' href='index.php-n=PmWiki.LayoutVariables.html#HTMLHeaderFmt'><code class='varlink'>&#36;HTMLHeaderFmt</code></a> array.
</p>
<p class='vspace question'> How would I create a markup (<em>(:nodiscussion:)</em>) that will set a page variable (<em>{$HideDiscussion}</em>) which can be used by <em>(:if enabled HideDiscussion:)</em> in .PageActions?</p>
<p> Add the following section of code to your config.php
</p><div class='indent'><pre class='escaped'>
SDV($HideDiscussion, 0); 	#define var name
Markup('hideDiscussion', '&lt;{$var}',
 '/\\(:nodiscussion:\\)/e', 'setHideDiscussion(true)'); 
function setHideDiscussion($val) { 
  global $HideDiscussion; 
  $HideDiscussion = $val;
} 
</pre>
</div><p class='vspace'>This will enable the <code>(:if enabled HideDiscussion:)</code> markup to be used.  If you want to print the current value of {$HideDiscussion} (for testing purposes) on the page, you'll also need to add the line:  <br /><code>$FmtPV['$HideDiscussion'] = '$GLOBALS["HideDiscussion"]';</code>
</p>
<p class='vspace question'> It appears that (.*?) does not match newlines in these functions, making the above example inoperable if the text to be wrappen in &lt;em&gt; contains new lines.</p>
<p> If you include the "s" modifier on the regular expression then the dot (.) will match newlines.  Thus your regular expression will be "/STUFF(.*?)/s".  That s at the very end is what you are looking for.  If you start getting into multi-line regexes you may be forced to look at the m option as well - let's anchors (^ and $) match not begin/end of strings but also begin/end of lines (i.e., right before/after a newline). Also make sure your markup is executed during the fulltext phase.
</p>
<p class='vspace question'> How can the text returned by my markup function be re-processed by the markup engine?</p>
<p> If the result of your markup contains more markup that should be processed, you have two options. First is to select a "when" argument that is processed earlier than the markup in your result. For example, if your markup may return [[links]], your "when" argument could be <code>"&lt;links"</code> and your markup will be processed before the links markup. The second option is to call the PRR() function in your markup definition or inside your markup function. In this case, after your markup is processed, PmWiki will restart all markups from the beginning. 
</p>
<p class='vspace question'> How do I get started writing recipes and creating my own custom markup?</p>
<p> <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/CustomMarkupAlt' rel='nofollow'>(alternate) Introduction to custom markup for Beginners</a>
</p>
<p class='vspace question'> How do I make a rule that runs once at the end of all other rule processing?</p>
<p> Use this statement instead of the usual <code>Markup()</code> call:
</p><dl><dd><div class='indent'><code>&#36;MarkupFrameBase['posteval']['myfooter'] = "\$out = onetimerule(\$out);";</code>
</div></dd></dl><p> 
</p></div><div style='clear:right; float:right; font-size:smaller; background-color:#eee;' >
<p><span class='wikitrail'>&lt; <a class='wikilink' href='index.php-n=PmWiki.Security.html'>Security</a> | <a class='wikilink' href='index.php-n=PmWiki.DocumentationIndex.html#trailstart'>Documentation Index</a> | <a class='wikilink' href='index.php-n=PmWiki.CustomWikiStyles.html'>Custom wiki styles</a> &gt;</span> 
</p></div>
<p><a name='trailend' id='trailend'></a>
<br clear='all' />
</p><div  style='background-color: #ffe; border-top: 1px solid black; font-size: .8em;' > 
<p>This page may have <span class='commentout-pmwikiorg'> a more recent version on <a class='urllink' href='http://www.pmwiki.org' rel='nofollow'>pmwiki.org</a>: <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/CustomMarkup' rel='nofollow'>PmWiki:CustomMarkup</a>, and </span> a talk page: <a class='urllink' href='http://www.pmwiki.org/wiki/PmWiki/CustomMarkup-Talk' rel='nofollow'>PmWiki:CustomMarkup-Talk</a>.
</p></div>
</div>

</div>

	    	</td>
  	</tr>
	</table>

   </td>
   <td width=200 align=right valign=top><br>

   <table cellspacing="2" cellpadding="0" border="0" width=200
bgcolor="#CCCFD6">
      <tr><td id='wikiright' height=2075 valign=top>
         <p  style='text-align: right;'> <a class='urllink' href='http://rednoise.org/~dhowe/' rel='nofollow'><strong><span style='font-size:83%'>Instructor: Dr. Daniel C. Howe</span></strong></a>
</p><h1>Resources</h1>
<ul><li><a class='urllink' href='http://p-dpa.net/' rel='nofollow'>Post-Digital</a>
</li><li><a class='urllink' href='http://www.arras.net/' rel='nofollow'>Arras.Net</a>
</li><li><a class='urllink' href='http://iloveepoetry.com/' rel='nofollow'>I Love ePoetry</a>
</li><li><a class='urllink' href='http://whitney.org/Exhibitions/Artport/Commissions/Codedoc' rel='nofollow'>CODeDoc</a>
</li><li><a class='urllink' href='http://www.thecontinentalreview.com/' rel='nofollow'>ContinentalReview</a>
</li><li><a class='urllink' href='http://www.drunkenboat.com/' rel='nofollow'>DrunkenBoat</a>
</li><li><a class='urllink' href='http://www.eastgate.com/ReadingRoom.html#' rel='nofollow'>Eastgate Systems</a>
</li><li><a class='urllink' href='http://www.electronicbookreview.com/' rel='nofollow'>Electronic Book Review</a>
</li><li><a class='urllink' href='https://eliterature.org/' rel='nofollow'>The Electronic Literature Org.</a>
</li><li><a class='urllink' href='http://collection.eliterature.org/1/' rel='nofollow'>E-Literature Collection 1</a>
</li><li><a class='urllink' href='http://collection.eliterature.org/2/' rel='nofollow'>E-Literature Collection 2</a>
</li><li><a class='urllink' href='http://collection.eliterature.org/3/' rel='nofollow'>E-Literature Collection 3</a>
</li><li><a class='urllink' href='http://newhorizons.eliterature.org/index.php.html' rel='nofollow'>New Horizons For The Literary</a>
</li><li><a class='urllink' href='http://writing.upenn.edu/epc/' rel='nofollow'>Electronic Poetry Center</a>
</li><li><a class='urllink' href='https://elmcip.net/' rel='nofollow'>The ELMCIP Database</a>
</li><li><a class='urllink' href='https://grandtextauto.soe.ucsc.edu/' rel='nofollow'>Grand Text Auto</a>
</li><li><a class='urllink' href='http://www.writing.upenn.edu/wh/' rel='nofollow'>Kelly Writers House</a>
</li><li><a class='urllink' href='https://www.cddc.vt.edu/journals/newriver/' rel='nofollow'>New River Journal</a>
</li><li><a class='urllink' href='http://nt2.uqam.ca/en/search/site/?f%5B0%5D=type:repertoire&retain-filters=1' rel='nofollow'>ALN / NT2</a>
</li><li><a class='urllink' href='http://www.writing.upenn.edu/pennsound/' rel='nofollow'>PENNsound</a>
</li><li><a class='urllink' href='http://www.ubu.com/' rel='nofollow'>UbuWeb</a> 
</li><li><a class='urllink' href='http://www.springgunpress.com' rel='nofollow'>Spring Gun Journal</a>
</li><li><a class='urllink' href='http://www.turbulence.org/' rel='nofollow'>Turbulence</a>
</li><li><a class='urllink' href='http://artport.whitney.org/' rel='nofollow'>The Whitney ARTPORT</a>
</li><li><a class='urllink' href='http://cellproject.net/' rel='nofollow'>E-Literature Consortium</a>
</li><li><a class='urllink' href='http://paper.li/eliterature' rel='nofollow'>This Week in E-Lit</a>
</li></ul><p class='vspace'><br />
</p><ul><li><a class='wikilink' href='index.php-n=Site.RightSideBar_action=edit.html'>SideBar</a>
</li></ul>

         <!--Main.SideBar-->
      </td></tr>
    </table>

  </td>
</tr>
</table>

</td>
</tr>
<!--PageFooterFmt-->
<tr>
  <td align="right" class="update">
    <div class='lastmod'>Page last modified on February 18, 2017, at 12:50 AM EST</div></div>
  </td>
</tr>
<!--/PageFooterFmt-->
</table>
</td>
</tr>

<tr>
<td align="right" class="copyright">
	&copy;howe
</td>
</tr>

</table>

</body>
</html>
