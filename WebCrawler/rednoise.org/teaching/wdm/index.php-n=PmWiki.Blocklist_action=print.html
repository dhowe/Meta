<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <title>Writing Digital Media | PmWiki / Blocklist</title>
  <link rel='stylesheet' href='pub/skins/print/print.css' type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none;}

--></style>  <meta name='robots' content='noindex,nofollow' />

</head>
<body>
  <div id='printhead'>
    <h3>From Writing Digital Media</h3>
    <h1 class='pagename'><a href='index.php-n=PmWiki.PmWiki.html'>PmWiki: Blocklist</a></h1>
  </div>
<!--PageText-->
<div id='wikitext'>
<p class='vspace'>The block list is one of a number of <a class='wikilink' href='index.php-n=PmWiki.Security_action=print.html'>security</a> measures that can be taken to protect your wiki from <a class='categorylink' href='index.php-n=Category.Spam.html'>spam</a> and other unwelcome postings.
</p>
<p class='vspace'>Unfortunately, the open-editability of many wiki systems often makes them attractive targets for "link spam" or "wikispam", in which links are added to pages in an effort to increase search engine rankings or drive traffic to other sites.  Also, many link spammers have developed automated systems to locate sites that accept visitor input and attempt to flood the site with unwanted links.
Also, and harder to deal with, is just plain <a class='wikilink' href='index.php-n=PmWiki.Security_action=print.html'>wiki vandalism</a> where nonsense changes are made, often replacing entire pages.
</p>
<p class='vspace'>By far the best countermeasure against wikispam is to restrict editing through the use of passwords (see <a class='wikilink' href='index.php-n=PmWiki.Passwords_action=print.html'>Passwords</a> and <a class='wikilink' href='index.php-n=PmWiki.PasswordsAdmin_action=print.html'>Passwords Admin</a>).  Experience has shown that passwords can be effective even if the password is widely known, and even if the password is publicly available on the site itself.  However, there are many cases where passwording may be an impediment, so these will generally want to use some form of blocklist.
</p>
<div class='vspace'></div><h2>Blocklist basics</h2>
<p>A <em>blocklist</em> is a list of IP addresses, phrases, and expressions which are prevented from being added into pages on the website.  PmWiki is distributed with a built-in blocklisting capability; blocklists can be enabled by adding the following line to <em>local/config.php</em>:
</p>
<div class='vspace'></div><div class='indent'><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklist'><code class='varlink'>&#36;EnableBlocklist</code></a> = 1;
</div><p class='vspace'>This tells PmWiki to scan the <a class='createlinktext' rel='nofollow'
    href='index.php-n=SiteAdmin.Blocklist_action=edit.html'>SiteAdmin.Blocklist</a><a rel='nofollow' 
    class='createlink' href='index.php-n=SiteAdmin.Blocklist_action=edit.html'>?</a> page and the "SiteAdmin.Blocklist-Farm" page (and possibly other pages -- see below) looking for phrases and IP addresses to be excluded from posting to the site.
</p>
<div class='vspace'></div><h3>Blocking by word or phrase</h3>
<p>The simplest form of block is simply a line containing "<code class='escaped'>block:</code>" followed by a word or phrase to be excluded from postings.  For example, a line like 
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>block:spam.com </code>
</div><p class='vspace'>in SiteAdmin.Blocklist will block any posts containing the string "spam.com" (case-insensitive) anywhere in the post.
</p>
<p class='vspace'><a name='blockbyipaddress' id='blockbyipaddress'></a>
</p><h3>Blocking by IP address</h3>
<p>Sometimes we wish to restrict posts coming from particular addresses or address ranges that are known as sources of wikispam.  If a blocklist page contains IP addresses of the form "a.b.c.d" or "a.b.c.*", then any posts coming from that address or range will be blocked. 
</p>
<div class='vspace'></div><div class='indent'><span class='note'> To find an author's IP address, try hovering the mouse over the author name in the <a class='wikilink' href='index.php-n=PmWiki.PageHistory_action=print.html'>page history</a> for a page.</span>
</div><div class='vspace'></div><h3>Blocking by regular expression or pattern</h3>
<p>Blocking on simple words can sometimes pose difficulties; for example, a simple "<code class='escaped'>block:cial</code>" entry will also block the word "specialist".  For these cases it's often helpful to use a regular expression, as in:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'>block:/\bcial\b/</code>
</div><p class='vspace'>This says to block "cial" only if it doesn't occur in the middle of a larger word.  The leading slash (/) after "block:" tells PmWiki to use a regular expression match instead of a simple string match.  (Blocklist uses PCRE or "Perl Compatible Regular Expressions"; see <a class='urllink' href='http://php.net/manual/en/ref.pcre.php' rel='nofollow'>http://php.net/manual/en/ref.pcre.php</a> for more information.)
</p>
<div class='vspace'></div><h4>Regular expression to block 'href'</h4>
<p>If you want to block '<code>href</code>', you can use the following markup:
</p><div class='indent'><code class='escaped'>block:/[^\w\\]href\b/</code>
</div><p>which blocks '<code>href</code>', but neither '<code>\href</code>' nor '<code>toughref</code>'.
</p>
<p class='vspace'>The regular expression can be interpreted as follows: Match any character that is <strong>neither</strong> a word character
<strong>nor</strong> a '\', followed by <code>href</code> which ends in a word boundary.
</p>
<div class='vspace'></div><h2>Letting authors know why they've been blocked</h2>
<p>By default, blocklist only tells an author that a particular edit has been blocked, but doesn't give a specific reason for the blocking (e.g., the offending phrase).  Setting the following in a local customization file will also provide the reasons for the block:
</p>
<div class='vspace'></div><div class='indent'><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableWhyBlocked'><code class='varlink'>&#36;EnableWhyBlocked</code></a> = 1;
</div><div class='vspace'></div><h2>Managing multiple blocklists</h2>
<p>PmWiki allows blocklist entries to come from multiple pages by setting the <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistPages'><code class='varlink'>&#36;BlocklistPages</code></a> variable.  By default <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistPages'><code class='varlink'>&#36;BlocklistPages</code></a> is set to "SiteAdmin.Blocklist", as well as any automatically downloaded blocklists as described below.  PmWiki will use all entries in all the blocklists for filtering wikispam. Setting a value of <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistPages'><code class='varlink'>&#36;BlocklistPages</code></a> changes the default:
</p>
<div class='vspace'></div><div class='indent'><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistPages'><code class='varlink'>&#36;BlocklistPages</code></a> = array('Main.Blocklist', 'PmWiki.Blocklist');
</div><p class='vspace'>The order of blocklists really doesn't matter -- all of the blocklist
pages ultimately get used, and the <code class='escaped'>unblock:</code> entries are processed 
after all of the blocklist pages have been loaded.
</p>
<p class='vspace'><a name='automaticblocklists' id='automaticblocklists'></a>
</p><h2>Automatically downloaded blocklists</h2>
<p>Maintaining blocklists is relatively easy to do, but can become tedious over time.  Several groups have formed and maintain "shared blocklists", where a common blocklist is made available to all.  PmWiki's blocklist capability has built-in features for automatically downloading and updating such shared blocklists.
</p>
<p class='vspace'>If you're just in a hurry to make use of some standard blocklists, make the following setting in <em>local/config.php</em>:
</p>
<div class='vspace'></div><div class='indent'><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklist'><code class='varlink'>&#36;EnableBlocklist</code></a> = 10;
</div><p class='vspace'>This tells PmWiki to not only enable blocklists on the site, but to also configure itself to automatically retrieve and maintain local copies of well-known blocklists such as <a class='urllink' href='http://moinmo.in/' rel='nofollow'>MoinMaster</a>.  These local copies will be saved in SiteAdmin.Blocklist-MoinMaster and refreshed once per day (as determined by the value of <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownloadRefresh'><code class='varlink'>&#36;BlocklistDownloadRefresh</code></a>).
</p>
<p class='vspace'>To automatically retrieve the <a class='createlinktext' rel='nofollow'
    href='index.php-n=SiteAdmin.Blocklist_action=edit.html'>SiteAdmin.Blocklist</a><a rel='nofollow' 
    class='createlink' href='index.php-n=SiteAdmin.Blocklist_action=edit.html'>?</a> page used at pmwiki.org, add the following setting in <em>local/config.php</em>:
</p>
<div class='vspace'></div><div class='indent'><code class='escaped'> $BlocklistDownload["$SiteAdminGroup.Blocklist-PmWiki"] = array('format' =&gt; 'pmwiki'); </code>
</div><p class='vspace'><small>The blocklist from chongqed.org which we used in the past is no longer available as of 2013.</small>
</p>
<div class='vspace'></div><h2>Ignoring specific entries in a blocklist (unblock) <a name='unblock' id='unblock'></a></h2>
<p>When using a large master blocklist or blocklists automatically refreshed from external sites, it may be that some entries in the blocklists are inappropriate or overeager and block legitimate content.  In this case a wikiadministrator can use "unblock" in a blocklist page to ignore an entry from the blocklist.  For example, to allow "spam.com" even if another blocklist has a block entry for it:
</p>
<div class='vspace'></div><div class='indent'>unblock:spam.com
</div><p class='vspace'>In order for unblocking to work the phrase or pattern following "unblock:" must be <em>exactly</em> the same as the original.
</p>
<div class='vspace'></div><h2>Permissions on blocklist pages</h2>
<p>In general, an <a class='wikilink' href='index.php-n=PmWiki.WikiAdministrator_action=print.html'>administrator</a> will want to edit-protect the SiteAdmin.Blocklist and any other blocklist pages to prevent arbitrary changes to the blocklist (see <a class='wikilink' href='index.php-n=PmWiki.Passwords_action=print.html'>Passwords</a>).  Since most pages in the SiteAdmin.* group are edit-protected by default anyway, this usually isn't a problem.
</p>
<p class='vspace'>Administrators may also wish to read-protect the various blocklist pages so that others do not know the exact phrases and/or IP addresses that are being blocked.  (By their nature blocklists tend to contain phrases or terms that may be offensive or inappropriate to some.)
</p>
<p class='vspace'>Any pages created via automatic download (see above) are automatically locked against viewing except by administrators.  
</p>
<p class='vspace'><span class='audience'> administrators (intermediate)</span>
</p><h2>Detailed configuration of automatically downloaded blocklists</h2>
<p>Automatic downloading of blocklist information is controlled by the <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownload'><code class='varlink'>&#36;BlocklistDownload</code></a> array.  An entry for MoinMaster might look like:
</p>
<div class='vspace'></div><div class='indent'><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownload'><code class='varlink'>&#36;BlocklistDownload</code></a>["<a class='varlink' href='index.php-n=PmWiki.BasicVariables.html#SiteAdminGroup'><code class='varlink'>&#36;SiteAdminGroup</code></a>.Blocklist-MoinMaster"] = array(
<div class='indent'>'url' =&gt; '<a class='urllink' href='http://moinmo.in/BadContent?action=raw' rel='nofollow'>http://moinmo.in/BadContent?action=raw</a>',
</div><div class='indent'>'format' =&gt; 'regex',
</div><div class='indent'>'refresh' =&gt; 86400);
</div></div><p class='vspace'>This says to download the blocklist data from the given url into the SiteAdmin.Blocklist-MoinMaster page, that the entries in the blocklist are regular expressions, and to refresh the information every 86,400 seconds (one day).
</p>
<p class='vspace'>If 'refresh' is omitted, then the page will be refreshed at the time interval given by <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownloadRefresh'><code class='varlink'>&#36;BlocklistDownloadRefresh</code></a> (default one day).  If 'format' is omitted, the page is assumed to have PmWiki-formatted entries as described above.  If 'url' is omitted, then the blocklist information is downloaded from a standard location on the pmwiki.org site.
</p>
<p class='vspace'>To force a refresh of an automatically downloaded blocklist, simply delete the existing page -- a new version will be installed upon the next blocklist scan.  Blocklist pages are checked for download in response to any ?action=edit request.
</p>
<p class='vspace'>If you are specifying your Blocklist-Pages in the config.php you have to specify the automatically updated pages too, else they won't be updated or created even if you use <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklist'><code class='varlink'>&#36;EnableBlocklist</code></a> = 10; .
</p>
<div class='vspace'></div><h2>Farm-wide blocklist</h2>
<p>A blocklist can be applied farm-wide  (see <a class='urllink' href='http://www.pmwiki.org/wiki/Cookbook/SharedPages' rel='nofollow'>SharedPages</a>).  
After these pages are created they can be moved into the farm <em>shared.d/</em> directory:
</p>
<div class='vspace'></div><h2><a name='variables' id='variables'></a> Blocklist Variables</h2>
<p>The following variables help control the configuration and operation of blocklists:
</p>
<div class='vspace'></div><dl><dt><a name='EnableBlocklist' id='EnableBlocklist'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklist'><code class='varlink'>&#36;EnableBlocklist</code></a></dt><dd>If set to a non-zero value, then blocklists are enabled on the site.  If set to a value of ten or higher, then add entries for automatic downloads of standard blocklists.
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklist'><code class='varlink'>&#36;EnableBlocklist</code></a> = 1;              # enable blocklists
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklist'><code class='varlink'>&#36;EnableBlocklist</code></a> = 10;             # auto-configure standard blocklists
<div class='vspace'></div></dd><dt><a name='EnableWhyBlocked' id='EnableWhyBlocked'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableWhyBlocked'><code class='varlink'>&#36;EnableWhyBlocked</code></a></dt><dd>By default, authors are not told which particular phrases or IP addresses are causing a particular post to be blocked; setting <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableWhyBlocked'><code class='varlink'>&#36;EnableWhyBlocked</code></a> to 1 provides this information.
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableWhyBlocked'><code class='varlink'>&#36;EnableWhyBlocked</code></a> = 1;             # give reasons for blocking
<div class='vspace'></div></dd><dt><a name='BlocklistPages' id='BlocklistPages'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistPages'><code class='varlink'>&#36;BlocklistPages</code></a></dt><dd>An array of pages to be checked for blocklist entries.  The elements of the array may contain <a class='wikilink' href='index.php-n=PmWiki.PageVariables_action=print.html'>page variables</a>.  Defaults to "SiteAdmin.Blocklist", plus any other automatically downloaded blocklist pages.
<div class='vspace'></div></dd><dt><a name='BlocklistMessageFmt' id='BlocklistMessageFmt'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistMessageFmt'><code class='varlink'>&#36;BlocklistMessageFmt</code></a></dt><dd>The message to provide the author whenever a post has been blocked.
<div class='vspace'></div></dd><dt><a name='BlockedMessagesFmt' id='BlockedMessagesFmt'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlockedMessagesFmt'><code class='varlink'>&#36;BlockedMessagesFmt</code></a></dt><dd>If <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableWhyBlocked'><code class='varlink'>&#36;EnableWhyBlocked</code></a> is set, defines the text to use for each type of block being performed.  Currently only 'ip' and 'text' are recognized.
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlockedMessagesFmt'><code class='varlink'>&#36;BlockedMessagesFmt</code></a>['ip'] = "IP address blocked from posting: ";
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlockedMessagesFmt'><code class='varlink'>&#36;BlockedMessagesFmt</code></a>['text'] = "Text blocked from posting: ";
<div class='vspace'></div></dd><dt><a name='BlocklistDownload' id='BlocklistDownload'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownload'><code class='varlink'>&#36;BlocklistDownload</code></a></dt><dd>An array of automatically-downloaded blocklists.  The keys of the array are the pages in which the blocklists should be stored, the values contain the url, format, and refresh interval for the downloaded blocklist.
</dd></dl><div class='indent'><pre class='escaped'>  # Download the MoinMaster blocklist every twelve hours
  $BlocklistDownload["$SiteAdminGroup.Blocklist-MoinMaster"] = array(
    'url' =&gt; 'http://moinmo.in/BadContent?action=raw', 
    'format' =&gt; 'regex',
    'refresh' =&gt; 43200);
  # Download a shared blocklist from pmwiki.org every day
  $BlocklistDownload["$SiteAdminGroup.Blocklist-Shared"] = array(
    'format' =&gt; 'pmwiki');
</pre>
</div><div class='vspace'></div><dl><dt><a name='BlocklistDownloadRefresh' id='BlocklistDownloadRefresh'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownloadRefresh'><code class='varlink'>&#36;BlocklistDownloadRefresh</code></a></dt><dd>The default refresh interval for any <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownload'><code class='varlink'>&#36;BlocklistDownload</code></a> entries that don't explicitly specify a 'refresh' value.
</dd><dt> </dt><dd> # perform automatic downloads once per week by default
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownloadRefresh'><code class='varlink'>&#36;BlocklistDownloadRefresh</code></a> = 86400 * 7;
<div class='vspace'></div></dd><dt><a name='BlocklistDownloadFmt' id='BlocklistDownloadFmt'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistDownloadFmt'><code class='varlink'>&#36;BlocklistDownloadFmt</code></a></dt><dd>The format to use when saving automatically downloaded blocklists.
<div class='vspace'></div></dd><dt><a name='EnableBlocklistImmediate' id='EnableBlocklistImmediate'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklistImmediate'><code class='varlink'>&#36;EnableBlocklistImmediate</code></a></dt><dd>Some cookbook recipes update pages with author input but don't use the built-in data posting routines.  If <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklistImmediate'><code class='varlink'>&#36;EnableBlocklistImmediate</code></a> is set (default) and the current action is listed in <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistActions'><code class='varlink'>&#36;BlocklistActions</code></a> (below), then an immediate blocklist scan is performed on the incoming text.
<div class='vspace'></div></dd><dt><a name='BlocklistActions' id='BlocklistActions'></a><a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistActions'><code class='varlink'>&#36;BlocklistActions</code></a></dt><dd>A list of actions for which immediate blocklist checks should be performed (see <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#EnableBlocklistImmediate'><code class='varlink'>&#36;EnableBlocklistImmediate</code></a> above).
</dd><dt> </dt><dd> # perform immediate checks for ?action=comment
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistActions'><code class='varlink'>&#36;BlocklistActions</code></a>['comment'] = 1;
</dd><dt> </dt><dd> # perform immediate checks for ?action=postdata
</dd><dt> </dt><dd> <a class='varlink' href='index.php-n=PmWiki.Blocklist.html#BlocklistActions'><code class='varlink'>&#36;BlocklistActions</code></a>['postdata'] = 1;
</dd></dl>
</div>

  <div id='printfoot'>
    <div class='from'>Retrieved from https://rednoise.org/teaching/wdm/index.php?n=PmWiki.Blocklist</div>
    <div class='lastmod'>Page last modified on May 02, 2016, at 08:27 PM EST</div></div>
<!--HTMLFooter-->
</body>
</html>
